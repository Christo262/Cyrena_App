@inherits DevelopComponentBase
@inject Cyrena.Contracts.ICurrentWindow _win

<Tooltip Title="Export Chat">
    <button type="button" class="btn btn-secondary btn-sm" @onclick="OnExport"><i class="bi bi-box-arrow-down"></i></button>
</Tooltip>

@code {
    private async Task OnExport()
    {
        var path = await _win.ShowSaveFile("Choose Location", "txt", ["*.txt"]);
        if (string.IsNullOrEmpty(path))
            return;

        var sb = new System.Text.StringBuilder();
        foreach (var item in Context.DisplayHistory)
        {
            sb.AppendLine($"[{item.Role.Label}]");
            sb.AppendLine(item.Content);
            sb.AppendLine();
        }

        try
        {
            await File.WriteAllTextAsync(path, sb.ToString());
        }
        catch (Exception ex)
        {
            Context.LogError("Export failed: " + ex);
        }
    }
}